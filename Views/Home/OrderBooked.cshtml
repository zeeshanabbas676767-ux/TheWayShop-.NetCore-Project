@using NewCoreProject.Models
@using NewCoreProject.Helpers
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    int row = 0;
    int totalQuan = 0;
    decimal totalBill = 0;

    // Get cart from session using Core extension method
    var cart = HttpContextAccessor.HttpContext?.Session.GetObjectFromJson<List<Product>>("mycart") ?? new List<Product>();
}

<!-- Start All Title Box -->
<div class="all-title-box">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>Order Booked</h2>
               @*  <ul class="breadcrumb">
                    <li class="breadcrumb-item active">Thank you for your trust!</li>
                </ul> *@
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->
<!-- Start Cart -->
<div class="cart-box-main">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="table-main table-responsive">
                    <table class="table table-secondary table-hover text-center">
                        <thead class="thead-dark">
                            <tr>
                                <th>Images</th>
                                <th>Product Name</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (cart != null && cart.Count > 0)
                            {
                                foreach (var item in cart)
                                {
                                    <tr>
                                        <td class="thumbnail-img">
                                            <img class="img-fluid rounded" src="@Url.Content(item.Product_Picture)" alt="Picture" style="width: 60px;" />
                                        </td>
                                        <td class="name-pr text-left">
                                            <strong>@item.Product_Name</strong>
                                            <div class="text-muted small">@item.Product_Description</div>
                                        </td>
                                        <td class="price-pr">
                                            <b>Rs. @item.Product_SalePrice</b>
                                        </td>
                                        <td class="quantity-box">
                                            <b>@item.Prod_Quantity</b>
                                        </td>
                                        <td class="total-pr">
                                            <b>Rs. @(decimal.Parse(item.Product_SalePrice.GetValueOrDefault().ToString()) * item.Prod_Quantity)</b>
                                        </td>
                                    </tr>

                                    row++;
                                    totalQuan += item.Prod_Quantity;
                                    totalBill += (decimal)item.Product_SalePrice.GetValueOrDefault() * item.Prod_Quantity;
                                }

                                HttpContextAccessor.HttpContext?.Session.SetDouble("totalAmount", (double)totalBill);
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center text-danger" style="font-size: 18px;">
                                        Your Shopping Cart is Empty.
                                        <a href="@Url.Action("DisplayProduct", "Home")" class="btn btn-link">Click Here to Buy!</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                        <tfoot class="font-weight-bold bg-light">
                            <tr>
                                <td colspan="3"></td>
                                <td>Total Quantity: @totalQuan</td>
                                <td>Total Bill: Rs. @totalBill</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <div class="row my-5">
            <div class="col-lg-6 col-sm-12">
                <div class="order-box p-3 shadow rounded bg-white">
                    <h3 class="text-primary mb-3">Customer Details</h3>
                    <div class="d-flex justify-content-between">
                        <span><strong>Customer Name</strong></span>
                        <span class="font-weight-bold text-muted">Auto-filled from order</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span><strong>Customer Email</strong></span>
                        <span class="font-weight-bold text-muted">Auto-filled from order</span>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between">
                        <span><strong>Contact</strong></span>
                        <span class="font-weight-bold text-muted">Auto-filled from order</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span><strong>Delivery Address</strong></span>
                        <span class="font-weight-bold text-muted">Auto-filled from order</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span><strong>Shipping Cost</strong></span>
                        <span class="font-weight-bold text-success">Free</span>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between text-dark">
                        <h5>Grand Total</h5>
                        <h5>Rs. @totalBill</h5>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<!-- End Cart -->
